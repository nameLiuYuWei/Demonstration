<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>虫情识别</title>
        <meta name="renderer" content="webkit|ie-comp|ie-stand">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
        <meta http-equiv="Cache-Control" content="no-siteapp" />
		<link rel="stylesheet" href="../../public/css/font.css">
		<link rel="stylesheet" href="../../public/css/weadmin.css">
		
		<style>
.tablebox {
    height: 150px;
    overflow: hidden;
    position: absolute;
    width: 400px;
    margin: 0px auto;
    background-color: rgba(6,26,103,1);
}

.tbl-header {
    width: 100%;
    position: absolute;
    top: 0;
    left: 0;
    z-index: 999;
}

.tbl-body {
    width: 100%;
    position: absolute;
    top: 0;
    left: 0;
}
.tablebox table {
    width: 100%;
}

.tablebox table th,
.tablebox table td {
    font-size: 8px;
    color: #7ca6f4;
    line-height: 30px;
    text-align: center;
}

.tablebox table tr th {
    background-color: #1f1f9c;
    cursor: pointer;
}

.tablebox table tr td {
    background-color: transparent;
}

.tbl-body tr:nth-child(even) td,.tbl-body1 tr:nth-child(even) td {
    background-color: rgba(31, 31, 156, .5);
}

.tablebox table tr td span,
.tablebox table tr td span {
    font-size: 24px;
}</style>

    </head>
    <body>

		  <div id="main" style="width:800px;height:600px;"></div>
		  
		 
		  
		  <div id="mainbg" style="width:800px;height:150px;top:0px;left:200px;background:#020933;">
		   <div id="mainbt" style="width:300px;height:150px;bottom:10px;left:499px;background:#020933;border:1px solid #808080;"></div>
		  </div>
		  
		  
		   <div class="tablebox" style="width:400px;height:150px;top:600px;left:50px;background:#020933;border:1px solid #808080;">
            
            <div class="tbl-header">
                <table border="0" cellspacing="0" cellpadding="0">
                    <thead>
                        <tr>
                            <th>排名</th>
                            <th>仙居乡镇</th>
                            <th>监控点数量(台)</th>
                            <th>虫数量(只)</th>
                            <th>日期</th>
                        </tr>
                    </thead>
                    <tbody style="opacity:0;"></tbody>
                </table>
            </div>
            
            <div class="tbl-body">
                <table border="0" cellspacing="0" cellpadding="0">
                    <thead>
                        <tr>
							<th>排名</th>
                            <th>地区</th>
                            <th>监控点数量</th>
                            <th>虫数量</th>
                            <th>日期</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
		  
        <script src="../../../public/echarts/echarts.js"></script>
		<script src="../../../public/js/jquery.min.js"></script>
		
<script>

  var myChart = echarts.init(document.getElementById('main'));
var imgUrl = "https://www.makeapie.com/asset/get/s/data-1597998044111-QKRPvTkC7.jpeg";

var uploadedDataURL = "xjbj.json";
//地理位置信息
var geoCoordMap = {
    "横溪镇": [120.48594270806781,28.743414705985856],
    "白塔镇": [120.60735372821208,28.75685891745399],
	"田市镇": [120.64105168313566,28.78134013790418],
    "官路镇": [120.66882630135893,28.83474516406105],
    "下各镇": [120.8619221910063,28.86446933207203],
    "朱溪镇": [120.84454581837979,28.73162100141002],
    '埠头镇': [120.53075674452094,28.758083341903593],
    '上张乡': [120.73818518840582,28.67004110976343],
    '安岭乡': [120.3595087228356,28.566189640307353],
    "溪港乡": [120.40650267726907,28.576193611995183],
	"湫山乡": [120.42757000757376,28.701002561007495],
    '皤滩乡': [120.54780793055293,28.743809548137413],
	'淡竹乡': [120.58210927728737,28.675844427379936],
	'步路乡': [120.72308143888824,28.802875879486006],
	'广度乡': [120.75471113520634,28.954058764904442],
	'大战乡': [120.82440149698628,28.82511992472225],
	'双庙乡': [120.85961624076296,28.79579202101374]

};


var geoCoordData = [{
        name: '横溪镇',
        value: "35000",
        info: {
            img: imgUrl
        }
    },
    {
        name: '白塔镇',
        value: "50000",
        info: {
            img: imgUrl
        }
    },
	{
        name: '田市镇',
        value: "10001",
        info: {
            img: imgUrl
        }
    },
    {
        name: '官路镇',
        value: "8999",
        info: {
            img: imgUrl
        }
    },
    {
        name: '下各镇',
        value: "35786",
        info: {
            img: imgUrl
        }
    },
    {
        name: '朱溪镇',
        value: "55111",
        info: {
            img: imgUrl
        }
    },
    {
        name: '埠头镇',
        value: "10121",
        info: {
            img: imgUrl
        }
    },
    {
        name: '上张乡',
        value: "20345",
        info: {
            img: imgUrl
        }
    },
    {
        name: '安岭乡',
        value: "31022",
        info: {
            img: imgUrl
        }
    },
    {
        name: '溪港乡',
        value: "41230",
        info: {
            img: imgUrl
        }
    },
	{
        name: '湫山乡',
        value: "14023",
        info: {
            img: imgUrl
        }
    },
    {
        name: '皤滩乡',
        value: "56011",
        info: {
            img: imgUrl
        }
    },
	{
        name: '淡竹乡',
        value: "15000",
        info: {
            img: imgUrl
        }
    },
	  {
        name: '步路乡',
        value: "35024",
        info: {
            img: imgUrl
        }
    },
	  {
        name: '广度乡',
        value: "15079",
        info: {
            img: imgUrl
        }
    },
	  {
        name: '大战乡',
        value: "65017",
        info: {
            img: imgUrl
        }
    },
	  {
        name: '双庙乡',
        value: "45011",
        info: {
            img: imgUrl
        }
    }
];
var convertData = function(data) {
    var res = [];
    for (var i = 0; i < data.length; i++) {
        var geoCoord = geoCoordMap[data[i].name];
        if (geoCoord) {
            res.push({
                name: data[i].name,
                value: geoCoord.concat(data[i].value),
                info: data[i].info || {}
            });
        }
    }
    return res;
};
var option = {
    backgroundColor: '#020933',
    title: {
        text: '仙居县地图',
        top: 5,
        subtext: '',
        sublink: '',
        left: 'center',
        textStyle: {
            color: '#ccc'
        }
    },
    tooltip: {
        trigger: 'item',
        triggerOn: 'click',
        showDelay: 0, //浮层显示的延迟
        transitionDuration: 0.2, // 提示框浮层的移动动画过渡时间
        enterable: true,
        formatter: function(params) {
            console.log(params)
            if (params.data) {
                let info = params.data.info || {};
                let html ='<div><img src="${info.img}" alt=""><div><span>名字：</span><span>${params.name}</span></div><button onclick="lookVideoGo($params.name})">查看</button></div>';
                return html
            } else {
                return
            }



        },
        // position: [10, 10],
        backgroundColor: "#fff"
    },
    visualMap: { //图例值控制
        min: 0,
        max: 100000,
        calculable: true,
        show: true,
        color: ['#f44336', '#fc9700', '#ffde00', '#ffde00', '#00eaff'],
        textStyle: {
            color: '#fff'
        }
    },
    //地理坐标
    geo: {
        map: 'tjbh',
        type: "map",
        aspectScale: 0.75, //长宽比
        zoom: 1.1,
        roam: false,
        itemStyle: {
            normal: {
                areaColor: '#013C62',
                shadowColor: '#182f68',
                shadowOffsetX: 0,
                shadowOffsetY: 25,
            },
            emphasis: {
                areaColor: '#2AB8FF',
                borderWidth: 0,
                color: 'green',
                label: {
                    show: false
                }
            }
        }
    },
    series: [{
            map: 'tjbh', //使用
            type: 'map',
            label: {
                normal: {
                    show: true,
                    textStyle: {
                        color: '#fff'
                    }
                },
                emphasis: {
                    textStyle: {
                        color: '#fff'
                    }
                }
            },

            itemStyle: {
                normal: {
                    borderColor: '#2ab8ff',
                    borderWidth: 1.5,
                    areaColor: '#12235c'
                },
                emphasis: {
                    areaColor: '#2AB8FF',
                    borderWidth: 0,
                    color: 'green'
                }
            },
            zoom: 1.1,
            roam: true,

        },


        //标记 图形 原点 scatter点 effectScatter涟漪特效
        {

            type: 'scatter',
            coordinateSystem: 'geo',
            symbolSize: 5,
            label: {
                normal: {
                    formatter: '{b}',
                    position: 'right',
                    show: true
                },
                emphasis: {
                    show: true
                }
            },
            hoverAnimation: true,
            itemStyle: {
                normal: {
                    color: '#fff'
                }
            },
            zlevel: 1,
            data: convertData(geoCoordData)
        },
        //标记图形 大头针
        {
            type: 'scatter',
            coordinateSystem: 'geo',
            symbol: 'pin', //标记的图形 图片参考：https://echarts.apache.org/zh/option.html#series-scatter.symbol
            symbolSize: [70, 70],
            label: {
                normal: {
                    show: true,
                    textStyle: {
                        color: 'red',
                        fontSize: 12,
                    },
                    formatter(value) {
                        return value.data.value[2]
                    }
                }
            },
            hoverAnimation: true,
            itemStyle: {
                normal: {
                    color: '#D8BC37', //标志颜色
                    // shadowBlur: 10,
                    // shadowColor: '#333'
                }
            },
            zlevel: 1,
            data: convertData(geoCoordData)
        }
    ]
};
var lookVideoGo = function(name) {
    console.log(name)
}
var getData = function() {
    $.get(uploadedDataURL, function(geojson) {
        echarts.registerMap('tjbh', geojson);
        myChart.setOption(option);
    })
}

getData()

myChart.on('georoam', function(params) {
    var option = myChart.getOption(); //获得option对象
    if (params.zoom != null && params.zoom != undefined) { //捕捉到缩放时
        option.geo[0].zoom = option.series[0].zoom; //下层geo的缩放等级跟着上层的geo一起改变
        option.geo[0].center = option.series[0].center; //下层的geo的中心位置随着上层geo一起改变
    } else { //捕捉到拖曳时
        option.geo[0].center = option.series[0].center; //下层的geo的中心位置随着上层geo一起改变
    }
    myChart.dispatchAction({
        type: 'restore'
    })
    myChart.setOption(option); //设置option
});

var chartDom = document.getElementById('mainbt');
var btChart = echarts.init(chartDom);
var btoption;

btoption = {
    title: {
        text: '',
        subtext: '虫情监控数源分布情况',
        left: 'center'
    },
    tooltip: {
        trigger: 'item'
    },

    series: [
        {
            name: '虫情分布',
            type: 'pie',
            radius: '30%',
            data: [
                {value: 120, name: '120台\n(10000只以上)'},
                {value: 650, name: '650台\n(5000-10000只)'},
                {value: 1200, name: '1200台\n(0-5000只)'}
            ],
            emphasis: {
                itemStyle: {
                    shadowBlur: 10,
                    shadowOffsetX: 0,
                    shadowColor: 'rgba(0, 0, 0, 0.5)'
                }
            }
        }
    ]
};

btoption && btChart.setOption(btoption);


var MyMarhq = '';
clearInterval(MyMarhq);
$('.tbl-body tbody').empty();
$('.tbl-header tbody').empty();
var str = '';
var Items = [{"Ranking":"1","City":"大战乡","SaleIncome":"312","SaleRough":"65017","SalePlan":"3月12日"},
    {"Ranking":"2","City":"皤滩乡","SaleIncome":"300","SaleRough":"56011","SalePlan":"3月12日"},
    {"Ranking":"3","City":"朱溪镇","SaleIncome":"280","SaleRough":"55111","SalePlan":"3月12日"},
    {"Ranking":"4","City":"白塔镇","SaleIncome":"350","SaleRough":"50000","SalePlan":"3月12日"},
    {"Ranking":"5","City":"溪港乡","SaleIncome":"272","SaleRough":"41230","SalePlan":"3月12日"},
    {"Ranking":"6","City":"下各镇","SaleIncome":"283","SaleRough":"35786","SalePlan":"3月12日"},
    {"Ranking":"7","City":"横溪镇","SaleIncome":"300","SaleRough":"35000","SalePlan":"3月12日"},
    {"Ranking":"8","City":"安岭乡","SaleIncome":"265","SaleRough":"31022","SalePlan":"3月12日"},
    {"Ranking":"9","City":"上张乡","SaleIncome":"255","SaleRough":"20345","SalePlan":"3月12日"},
    {"Ranking":"10","City":"广度乡","SaleIncome":"180","SaleRough":"15079","SalePlan":"3月12日"}]
$.each(Items,function (i, item) {
    str = '<tr>'+
        '<td>'+item.Ranking+'</td>'+
        '<td>'+item.City+'</td>'+
        '<td>'+item.SaleIncome+'</td>'+
        '<td>'+item.SaleRough+'</td>'+
        '<td>'+item.SalePlan+'</td>'+
        '</tr>'

    $('.tbl-body tbody').append(str);
    $('.tbl-header tbody').append(str);
});

if(Items.length > 3){
    $('.tbl-body tbody').html($('.tbl-body tbody').html()+$('.tbl-body tbody').html());
    $('.tbl-body').css('top', '0');
    var tblTop = 0;
    var speedhq = 150; // 数值越大越慢
    var outerHeight = $('.tbl-body tbody').find("tr").outerHeight();
    function Marqueehq(){
        if(tblTop <= -outerHeight*Items.length){
            tblTop = 0;
        } else {
            tblTop -= 1;
        }
        $('.tbl-body').css('top', tblTop+'px');
    }

    MyMarhq = setInterval(Marqueehq,speedhq);

    // 鼠标移上去取消事件
    $(".tbl-header tbody").hover(function (){
        clearInterval(MyMarhq);
    },function (){
        clearInterval(MyMarhq);
        MyMarhq = setInterval(Marqueehq,speedhq);
    })

}
</script>
    </body>
</html>